<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–æ–∫</title>

    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 50px;
            background-color: #f4f4f9;
        }

        .form-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 300px;
            margin-bottom: 40px;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            width: 100%;
            padding: 10px;
            background: #4CAF50;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }

        button:hover {
            background: #45a049;
        }

        #feed {
            width: 500px;
            max-width: 100%;
        }

        .post {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .time {
            font-size: 12px;
            color: gray;
        }

        .like-btn {
            margin-top: 10px;
            background: #2196F3;
        }

        .like-btn:hover {
            background: #1976D2;
        }
    </style>
</head>

<body>

<div class="form-container">
    <h3>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</h3>
    <form id="feedbackForm">
        <input type="text" id="username" placeholder="–í–∞—à–µ –∏–º—è" required>
        <input type="email" id="userEmail" placeholder="–í–∞—à Email" required>
        <textarea id="userComment" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" required></textarea>
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
    </form>
</div>

<div id="feed"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import {
        getFirestore,
        addDoc,
        collection,
        serverTimestamp,
        onSnapshot,
        query,
        orderBy,
        doc,
        updateDoc,
        increment
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBVbhWbVDyhWGqC4x176LpjzSnrTE_rKe0",
        authDomain: "gf-8654a.firebaseapp.com",
        projectId: "gf-8654a",
        storageBucket: "gf-8654a.firebasestorage.app",
        messagingSenderId: "716147853392",
        appId: "1:716147853392:web:f87336c7a9378fb93f6955",
        measurementId: "G-7HJ13ZP986"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById("feedbackForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const nameInput = document.getElementById("username").value;
        const emailInput = document.getElementById("userEmail").value;
        const commentInput = document.getElementById("userComment").value;

        try {
            await addDoc(collection(db, "requests"), {
                name: nameInput,
                email: emailInput,
                comment: commentInput,
                likes: 0,
                timestamp: serverTimestamp()
            });

            alert("–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
            document.getElementById("feedbackForm").reset();

        } catch (error) {
            console.error("–û—à–∏–±–∫–∞:", error);
            alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏.");
        }
    });

    // –õ–∞–π–∫
    window.processLike = async (id) => {
        const docRef = doc(db, "requests", id);
        await updateDoc(docRef, {
            likes: increment(1)
        });
    };

    // –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
    const q = query(collection(db, "requests"), orderBy("timestamp", "desc"));

    onSnapshot(q, (snapshot) => {
        const feed = document.getElementById("feed");
        feed.innerHTML = "";

        snapshot.forEach((docItem) => {
            const data = docItem.data();

            feed.innerHTML += `
                <div class="post">
                    <span class="time">
                        ${data.timestamp?.toDate().toLocaleString() || "..."}
                    </span>
                    <p><strong>${data.name}</strong></p>
                    <p>${data.email}</p>
                    <p style="margin-top:8px;">üí¨ ${data.comment || ""}</p>
                    <button class="like-btn" onclick="processLike('${docItem.id}')">
                        üëç ${data.likes || 0}
                    </button>
                </div>
            `;
        });
    });
</script>

</body>
</html>
